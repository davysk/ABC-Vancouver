"use strict";var WPFormsStripeElements=window.WPFormsStripeElements||function(e,a){var o={stripe:null,init:function(){o.stripe=Stripe(wpforms_stripe.publishable_key,{locale:wpforms_stripe.data.element_locale}),a(e).on("wpformsReady",function(){a(".wpforms-stripe form").each(o.setupStripeForm)})},setupStripeForm:function(){var e=a(this);o.updateFormSubmitHandler(e),e.on("wpformsAjaxSubmitActionRequired",o.handleCardActionCallback)},setupCardElement:function(r,i){var n=r.find(".wpforms-stripe-credit-card-hidden-input"),e=wpforms_stripe.data.element_style;a.isEmptyObject(e)&&(e=o.getElementStyleDefault(n));e={classes:wpforms_stripe.data.element_classes,hidePostalCode:!0,style:e},e=o.stripe.elements().create("card",e);return e.mount(r.find(".wpforms-field-stripe-credit-card-cardnumber").get(0)),e.on("change",function(e){var t;e.error?(t=e.error.message,"incomplete_number"!==e.error.code&&"invalid_number"!==e.error.code||(t=wpforms_settings.val_creditcard),o.displayStripeError(r,t)):i.hideThese(i.errorsFor(n.get(0)))}),n.data("stripe-element",e),e},getElementStyleDefault:function(e){var t={base:{fontSize:e.css("font-size"),color:e.css("color")}},r=e.css("font-family"),e=/[“”<>!@$%^&*=~`|{}[\]]/;return!e.test(r)&&-1===r.indexOf("MS Shell Dlg")||(r=a("p").css("font-family")),e.test(r)||(t.base.fontFamily=r),t},updateFormSubmitHandler:function(n){var e=n.validate(),a=e.settings.submitHandler,s=o.setupCardElement(n,e),d=n.find(".wpforms-field-stripe-credit-card-cardnumber");e.settings.submitHandler=function(){var e=n.validate().form(),t=d.hasClass(wpforms_stripe.data.element_classes.empty),r=d.data("required"),i=d.closest(".wpforms-field-stripe-credit-card").hasClass("wpforms-conditional-hide");if(e&&(i?!1:r||!t&&!r))n.find(".wpforms-submit").prop("disabled",!0),o.createPaymentMethod(n,s,r,a);else{if(e)return n.find(".wpforms-submit").prop("disabled",!1),a(n);n.find(".wpforms-submit").prop("disabled",!1),n.validate().cancelSubmit=!0}}},createPaymentMethod:function(t,e,r,i){o.stripe.createPaymentMethod("card",e,{billing_details:{name:t.find(".wpforms-field-stripe-credit-card-cardname").val()}}).then(function(e){return e.error&&r?(t.find(".wpforms-submit").prop("disabled",!1),o.displayStripeError(t,e.error.message),void(t.validate().cancelSubmit=!0)):(e.error||(t.find(".wpforms-stripe-payment-method-id").remove(),e.paymentMethod&&t.append('<input type="hidden" class="wpforms-stripe-payment-method-id" name="wpforms[payment_method_id]" value="'+e.paymentMethod.id+'">')),void i(t))})},handleCardActionCallback:function(e,t){var r=a(this);t.success&&t.data.action_required&&o.stripe.handleCardPayment(t.data.payment_intent_client_secret).then(function(e){o.handleCardPaymentCallback(r,e)})},handleCardPaymentCallback:function(e,t){t.error?(o.formAjaxUnblock(e),e.find(".wpforms-field-stripe-credit-card-cardnumber").addClass(wpforms_stripe.data.element_classes.invalid),o.displayStripeError(e,t.error.message)):t.paymentIntent&&"succeeded"===t.paymentIntent.status?(e.find(".wpforms-stripe-payment-method-id").remove(),e.find(".wpforms-stripe-payment-intent-id").remove(),e.append('<input type="hidden" class="wpforms-stripe-payment-intent-id" name="wpforms[payment_intent_id]" value="'+t.paymentIntent.id+'">'),wpforms.formSubmitAjax(e)):o.formAjaxUnblock(e)},displayStripeError:function(e,t){var r={};r[e.find(".wpforms-stripe-credit-card-hidden-input").attr("name")]=t,wpforms.displayFormAjaxFieldErrors(e,r)},formAjaxUnblock:function(e){var t=e.closest(".wpforms-container"),r=e.find(".wpforms-submit-spinner"),i=e.find(".wpforms-submit"),e=i.data("submit-text");e&&i.text(e),i.prop("disabled",!1),t.css("opacity",""),r.hide()}};return o}(document,(window,jQuery));WPFormsStripeElements.init();